<!DOCTYPE html>
<html>
<head>
    <title>Razorpay Test</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
    <h2>Test Razorpay Payment</h2>
    <input id="deviceId" placeholder="Device ID" value="TEST12345678" />
    <select id="tier">
        <option value="DAILY">Daily - â‚¹49</option>
        <option value="WEEKLY">Weekly - â‚¹199</option>
        <option value="MONTHLY">Monthly - â‚¹499</option>
    </select>
    <button onclick="startPayment()">Pay Now</button>
    <div id="result"></div>

    <script>
        async function startPayment() {
            const deviceId = document.getElementById('deviceId').value;
            const tier = document.getElementById('tier').value;
            
            // Create order
            const response = await fetch('http://localhost:3000/create-order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tier, deviceId })
            });
            
            const order = await response.json();
            
            // Open Razorpay checkout
            const options = {
                key: order.keyId,
                amount: order.amount,
                currency: 'INR',
                name: 'Interview Cracker AI',
                description: tier + ' Plan',
                order_id: order.orderId,
                handler: async function (response) {
                    // Verify payment
                    const verify = await fetch('http://localhost:3000/verify-payment', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_signature: response.razorpay_signature,
                            deviceId,
                            tier
                        })
                    });
                    
                    const result = await verify.json();
                    document.getElementById('result').innerHTML = 
                        `<h3>Success! ðŸŽ‰</h3><p>License Key: <strong>${result.licenseKey}</strong></p>`;
                }
            };
            
            const rzp = new Razorpay(options);
            rzp.open();
        }
    </script>
</body>
</html>
